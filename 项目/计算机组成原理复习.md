# 第1章 计算机系统概述

## 核心逻辑图谱
这一章是整个计算机科学的物理宪法。它定义了硬件如何承载软件（冯·诺依曼），软件如何控制硬件（ISA），以及这种交互的效率如何衡量（性能评价）。

---

## 1. 架构基石：冯·诺依曼
![[冯诺依曼架构]]

---

## 2. 交互契约：ISA 与层次
![[ISA与系统层次]]

---

## 3. 性能标尺：Amdahl 定律
![[性能评价与Amdahl]]

---

## 复习自测 (Checklist)
- [ ] 能否手画冯·诺依曼五大部件的数据流向？
- [ ] 能否解释为什么 ISA 是软硬件的接口？
- [ ] **计算题突破**：是否完成了课后习题 6, 7, 8, 9, 11？

# 第2章 数据的机器级表示

## 核心逻辑图谱
本章揭示了 0 和 1 如何被解释为数字、字符和逻辑状态。对于安全人员，这里到处是“解释差异”导致的漏洞。

---

## 1. 整数的陷阱
![[补码]]
* *关键点*：补码的不对称性、符号扩展导致的漏洞。

---

## 2. 浮点数的奥秘
![[IEEE754浮点数]]
* *关键点*：移码偏置值 (127) 的计算，NaN 与 Inf 的表示。

---

## 3. 内存布局的物理法则
![[端序与对齐]]
* *关键点*：大端 vs 小端，结构体对齐计算。

---

## 4. 其他知识点
* **字符编码**：
    * ASCII：7位编码，高位为0。
    * 汉字：GB2312/GBK（双字节），Unicode (UCS-2) 统一编码。
* **BCD 码**：4位二进制表示1位十进制（8421码），用于金融或为了减少转换误差。
* **校验码**：
    * 奇偶校验 (Parity)：只能检错奇数位，不能纠错。
    * *注：海明码和 CRC 也是重点，但PPT中仅略提，需结合后续章节或习题强化。*

---

## 实战作业
PPT 最后一页作业题

# 第3章 运算方法和运算部件 (Index)

## 核心逻辑图谱
本章深入到了计算机的“算力”核心。从最底层的全加器，到能够欺骗人类直觉的浮点运算，再到决定程序流向的标志位。

---

## 1. 算力的物理基础
![[ALU与进位机制]]
* *关键点*：先行进位 (CLA) 是高性能 CPU 的基石。

---

## 2. 整数：溢出与标志位
![[整数运算与标志位]]
* *实战重点*：**OF (Signed) vs CF (Unsigned)**。这是 CTF 和漏洞挖掘中判定整数溢出的金标准。

---

## 3. 浮点：精度与对阶
![[浮点数运算]]
* *计算流程*：对阶 $\to$ 尾数运算 $\to$ 规格化 $\to$ 舍入。

---

## 复习自测 (Checklist)
- [ ] **OF vs CF**: 能够区分 $1000 + 1000$ (4位二进制) 在有符号和无符号视角下的溢出情况吗？
    - *答案*：$1000(-8) + 1000(-8) = 10000(0)$。有符号：OF=1 (负+负=0/正，溢出)。无符号：CF=1 (进位)。
- [ ] **浮点对阶**：为什么是“小阶看齐大阶”？
- [ ] **ALU 构造**：并行进位加法器比串行进位快在哪里？

## 作业题解题思路 (Homework Hints)
* **题 3, 7, 11, 12**：这些题通常考察补码加减法的溢出判断、Booth 乘法(若考纲有)或浮点数的加法步骤。
* **重点**：做浮点数加法题时，务必把“规格化”这一步写清楚，这是最大的扣分点。

# 第4章 指令系统

## 核心逻辑图谱
本章探讨了软硬件的接口 (ISA)。从设计原则出发，对比了 CISC/RISC 的哲学，并深入解析了经典的 MIPS 和新兴的 RISC-V。

---

## 1. 设计哲学：契约与权衡
![[指令系统设计原理]]
* *关键点*：寻址方式是计算有效地址的核心，也是内存安全漏洞的利用通道。CISC vs RISC 是架构复杂度的博弈。

---

## 2. 经典案例：MIPS
![[MIPS指令详解]]
* *关键点*：3种指令格式 (R/I/J)，Load/Store 架构，对齐要求。

---

## 3. 未来之星：RISC-V
![[RISCV架构]]
* *关键点*：模块化设计，无标志位设计，压缩指令集。

---

## 复习自测 (Checklist)
- [ ] **寻址计算**：给定基址寄存器值和偏移量，能计算出有效地址吗？
- [ ] **汇编翻译**：能将 `A[i] = h + A[i]` (假设 int 数组) 翻译成 MIPS/RISC-V 汇编吗？（注意 `i` 要乘以 4）。
- [ ] **比较**：MIPS 的 `beq` 和 RISC-V 的 `beq` 有什么区别？（MIPS 比较寄存器相等跳转；RISC-V 也是，但 RISC-V 的分支判断更丰富，且无延迟槽）。

## 作业题解题思路 (Homework Hints)
* **P125 题 3, 4**：通常涉及指令格式的位域划分。**注意操作码和功能码的位数。**
* **题 6, 7**：寻址方式计算。**警惕 PC 相对寻址**，MIPS 的 PC 通常指“下下条”指令地址（PC+4），而 RISC-V 是当前指令地址。偏移量通常是**字偏移**还是**字节偏移**？（MIPS 分支指令偏移量是字，计算地址需 `<< 2`；RISC-V 也是字节偏移但省略最低位）。
* **题 10**：汇编代码编写。**画出 C 语言的流程图**，再直译为汇编，特别是循环结构。

# 第5章 中央处理器

## 核心逻辑图谱
本章是计算机的“心脏”。我们从数据通路的构建开始，设计出控制它们的神经系统（控制器），并最终赋予它处理意外的能力（异常机制）。

---

## 1. 物理基础：数据通路
![[数据通路与时序]]
* *关键点*：时钟周期由最慢的路径决定（通常是 Load）。

---

## 2. 架构实现：单周期 MIPS
![[MIPS单周期设计]]
* *关键点*：能够画出 `lw`, `sw`, `beq` 的数据流向，并确定控制信号的值。

---

## 3. 控制大脑：硬布线与微程序
![[控制器设计]]
* *关键点*：微程序是软件定义硬件的桥梁，也是 CPU 可修补的基础。

---

## 4. 系统的护栏：异常与中断
![[异常与中断]]
* *关键点*：`EPC` 和 `Cause` 寄存器的作用，精确异常的概念。

---

## 复习自测 (Checklist)
- [ ] **数据通路绘制**：能凭记忆画出 MIPS 单周期处理器的简图吗？（PC -> IM -> Reg -> ALU -> DM -> Reg）。
- [ ] **控制信号推导**：`beq` 指令执行时，`ALUSrc` 是 0 还是 1？（答：0，因为要比较两个寄存器）。`RegWrite` 呢？（答：0，分支不写寄存器）。
- [ ] **异常流程**：发生溢出时，CPU 硬件具体做了哪几件事？（写 EPC，写 Cause，跳异常入口）。

## 作业题解题思路 (Homework Hints)
* **补充题 2 (控制信号填表)**：
    * **addu**：R型，`RegDst=1` (rd), `ALUSrc=0` (Reg), `RegWrite=1`, `ALUOp` 对应加法。
    * **addi**：I型，`RegDst=0` (rt), `ALUSrc=1` (Imm), `RegWrite=1`, `ALUOp` 对应加法。
    * **bne**：Branch，`Branch=1`, `ALUOp` 对应减法（比较），`RegWrite=0`。
    * *技巧*：先判断指令类型（R/I/J），再定大方向，最后扣细节。

# 第6章 指令流水线

## 核心逻辑图谱
本章揭示了 CPU 如何通过“时间管理”实现性能飞跃。从基础的五级流水线，到解决冲突的冒险处理，再到现代 CPU 的乱序执行。

---

## 1. 流水线基石
![[流水线原理]]
* *关键点*：五级流水线 (IF, ID, EX, MEM, WB) 的划分。

---

## 2. 冒险与冲突 (漏洞之源)
![[流水线冒险]]
* *关键点*：数据冒险的转发技术，控制冒险的分支预测（Spectre 原理）。

---

## 3. 性能极限
![[高级流水线]]
* *关键点*：超标量与乱序执行。

---

## 复习自测 (Checklist)
- [ ] **数据冒险**：能识别出代码中的 RAW 依赖吗？知道转发 (Forwarding) 能解决哪些，解决不了哪些（如 Load-Use）吗？
    - *Load-Use 必须停顿一个周期。*
- [ ] **分支预测**：2 位动态预测的状态机是如何工作的？（强不跳 $\leftrightarrow$ 弱不跳 $\leftrightarrow$ 弱跳 $\leftrightarrow$ 强跳）。
- [ ] **流水线图**：能画出指令序列的时空图 (Space-Time Diagram) 吗？

## 作业题解题思路 (Homework Hints)
* **P203 题 6-12**：这些题通常考察：
    * **画时空图**：展示有/无转发情况下的流水线执行。
    * **计算加速比**：$Speedup = \frac{T_{serial}}{T_{pipeline}}$。
    * **分支预测惩罚**：计算分支指令造成的额外开销周期。
* **重点**：遇到 Load-Use 冒险时，即使有转发，也必须**插入一个气泡 (Stall)**。这是考题中最常见的坑。

# 第7章 存储器层次结构

## 核心逻辑图谱
本章构建了现代计算机的“记忆宫殿”。从快而小的 Cache 到慢而大的磁盘，通过映射机制（Mapping）和局部性原理（Locality）欺骗 CPU，让它以为自己拥有又快又大的内存。

---

## 1. 存储金字塔
![[存储层次结构]]
* *关键点*：多模块交叉编址提升带宽。

---

## 2. 速度的魔法：Cache
![[Cache机制]]
* *关键点*：直接映射 vs 组相联，LRU 算法，写回策略。

---

## 3. 容量与隔离：虚拟存储
![[虚拟存储器]]
* *关键点*：页表、TLB、缺页异常、权限位。

---

## 4. 系统观：宏观对比
![[Cache与虚存对比]]
* *关键点*：硬件处理 vs 操作系统处理。

---

## 复习自测 (Checklist)
- [ ] **地址计算**：给定主存地址和 Cache 结构（行数、块大小），能拆分出 Tag、Index、Offset 吗？
    - *公式*：$Index = \log_2(\text{组数})$，$Offset = \log_2(\text{块大小})$。
- [ ] **容量计算**：Cache 的总容量 = 数据区 + 标记区（Tag + Valid + Dirty）。**Tag 位数计算是必考题。**
- [ ] **访存流程**：能画出 CPU $\to$ TLB $\to$ Cache $\to$ Main Memory 的流程图吗？（注意并行查找）。

## 作业题解题思路 (Homework Hints)
* **P268 题 3**：可能是 Cache 容量或映射计算。注意单位换算（位 vs 字节）。
* **题 18, 24**：通常涉及 Cache 命中率分析或虚实地址转换。
* **实战技巧**：
    * 做映射题时，先画出地址的位划分图（Tag | Index | Offset）。
    * 计算 Tag 位数 = 主存块号位数 - Cache 组号位数。

# 第8章 互连及输入输出组织 (Index)

## 核心逻辑图谱
本章解释了计算机如何与外部世界交互。从底层的物理存储介质，到连接它们的总线网络，再到 CPU 管理这些设备的策略进化。

---

## 1. 物理基础：磁盘与性能
![[磁盘与存储性能]]
* *关键点*：寻道时间是机械硬盘的命门，RAID 提升吞吐和可靠性。

---

## 2. 互连骨架：总线与接口
![[总线与接口]]
* *关键点*：内存映射 I/O (RISC/ARM) vs 独立 I/O (x86)。

---

## 3. 进化之路：控制方式
![[IO控制方式]]
* *关键点*：轮询 $\to$ 中断 $\to$ DMA。CPU 逐渐解耦，专注于计算。

---

## 复习自测 (Checklist)
- [ ] **存取时间计算**：给定转速（如 7200 RPM）和寻道时间，能算出读取一个扇区的平均时间吗？
    - *公式*：$T = T_{seek} + \frac{60}{2 \times RPM} + T_{transfer}$。
- [ ] **CPU 占用率计算**：对比中断方式和 DMA 方式传输 1MB 数据，CPU 分别花费多少时间？
    - *中断*：每传一个字（或字节）都要中断一次。
    - *DMA*：只在开始和结束中断两次。
- [ ] **概念辨析**：I/O 端口和内存地址重叠吗？（取决于编址方式）。

## 作业题解题思路 (Homework Hints)
* **P327 题 4**：通常是磁盘性能计算。注意单位换算（ms vs s，Byte vs bit）。**旋转延迟取平均值（转半圈）**。
* **题 8, 10, 11**：考察 DMA 与中断的效率对比。
    * *思路*：计算传输一定量数据（如 4KB），中断方式需要响应多少次？DMA 方式需要响应多少次？乘以每次响应的时钟周期，得出总开销。通常 DMA 会有几百倍的性能提升。

# 复习
#### Sprint 1：底层重构 (Day 1 - Day 5)

**目标**：彻底搞定 **数据的表示 (Ch2)**、**运算器 (Ch3)** 和 **存储系统 (Ch7)**。

- **逻辑链**：数据如何在物理层面上存在？$\rightarrow$ 如何被加工？$\rightarrow$ 如何被高速存取？
    

1. **Day 1-2: 数据的机器级表示 & 运算 (Ch2, Ch3)**
    
    - **满绩痛点**：
        
        - **IEEE 754**：不仅要会算，还要懂**特殊值**（NaN, Inf, 非规格化数）和**精度丢失**的原理。这直接关联到以后的浮点数漏洞挖掘。
            
        - **ALU 细节**：不仅要知道补码加减，要搞懂 **OF (溢出) 和 CF (进位) 的电路级区别**。这是汇编语言中 `jg` 和 `ja` 的本质区别。
            
    - **动作**：
        
        - 打开 `Ch2` 和 `Ch3` 的笔记。
            
        - **手写**推导一遍 IEEE 754 的 $E = e + Bias$ 过程。
            
        - 找一道复杂的补码乘法（Booth算法，如果考纲有）题，模拟每一步寄存器的变化。
            
2. **Day 3-5: 存储层次结构 (Ch7) —— 重中之重**
    
    - **满绩痛点**：
        
        - **Cache 映射**：不仅要会算 Tag/Index/Offset，还要能分析**由虚存地址（VA）到物理地址（PA）再到 Cache 命中**的全过程（TLB + PageTable + Cache 并行查找）。这是大题的高发区。
            
        - **替换算法**：理解 LRU 在硬件上是如何通过“计数器”或“栈”实现的，而不仅仅是画图。
            
    - **动作**：
        
        - **画图**：在一张白纸上，画出 CPU 发出一个虚拟地址 VA，经过 TLB、页表、Cache、主存，最后拿到数据的**完整数据流图**。标出每一处的 Hit/Miss 处理逻辑。
            
        - **刷题**：PPT 作业中的 P268 题 18、24、25 必须烂熟于心。
            

#### Sprint 2：核心攻坚 (Day 6 - Day 10)

**目标**：拿下 **指令系统 (Ch4)**、**CPU (Ch5)** 和 **流水线 (Ch6)**。这是计组的灵魂，也是最难啃的骨头。

- **逻辑链**：软件怎么指挥硬件？$\rightarrow$ 硬件怎么单步执行？$\rightarrow$ 硬件怎么并行加速？
    

1. **Day 6: 指令系统 (Ch4)**
    
    - **满绩痛点**：**寻址方式**的有效地址计算（特别是 PC 相对寻址的 Offset 计算细节，是相对于当前指令还是下一条？）。
        
    - **动作**：对比 MIPS 和 RISC-V 的指令格式，理解为什么 RISC 要把指令做成定长。
        
2. **Day 7-8: 单周期 CPU (Ch5) —— 决胜局**
    
    - **满绩痛点**：**控制信号 (Control Signals)**。给你一条新指令（比如 `addi` 或 `jal`），你能否推导出 RegDst, ALUSrc, MemToReg, PCSrc 这一排信号是 0 还是 1？
        
    - **动作**：
        
        - **模拟运行**：打开 PPT 第 43 页（单周期数据通路图）。闭上眼，想象一条 `lw` 指令进入，红色的电流是如何流过 MUX、ALU、Data Memory 的。
            
        - **填表**：找一张空的控制信号表，自己填一遍所有指令的信号值。
            
3. **Day 9-10: 流水线 (Ch6) —— 难点**
    
    - **满绩痛点**：**冒险 (Hazards)**。
        
        - **数据冒险**：什么时候需要 **Forwarding (转发)**？什么时候转发也救不了，必须 **Stall (阻塞)**（特别是 Load-Use）？
            
        - **控制冒险**：分支预测失败后的 **Flush (冲刷)** 机制，要在时空图上画出来。
            
    - **动作**：画时空图。找一道复杂的代码段（包含依赖和跳转），画出有转发和无转发两种情况下的流水线图。
        

#### Sprint 3：系统互连与综合 (Day 11 - Day 12)

**目标**：**总线与 I/O (Ch8)**。

- **逻辑链**：CPU 如何与慢速世界交互？
    

1. **Day 11: 总线 & I/O**
    
    - **满绩痛点**：**DMA vs 中断** 的效率计算。传输 1MB 数据，DMA 比中断到底省了多少 CPU 周期？（要算上 DMA 初始化和结束中断的开销）。
        
    - **动作**：搞懂 PPT 中的计算例题。理解 **统一编址 vs 独立编址** 对驱动程序编写的影响。
        

#### Sprint 4：真题模拟与查漏补缺 (Day 13 - Day 15)

**目标**：回归课本，应试技巧。

1. **Day 13-15: 刷题 & 回归**
    
    - **刷真题**：电子科大的期末题通常有固定的套路（比如大题必考 Cache 设计或 CPU 数据通路）。找往年真题，**限时训练**。
        
    - **回归 Obsidian**：看着你的目录，对自己进行“灵魂拷问”。
        
        - 看到“TLB”，你能说出它和 Cache 的区别吗？
            
        - 看到“补码”，你能说出它为什么能统一加减法吗？